# 工作流名称：清晰标识功能（测试自动化）
name: tests
# 触发条件：当代码推送到仓库时，自动执行该工作流
on: push
# 任务定义：包含所有需要执行的自动化步骤
jobs:
  # 具体任务名称：执行测试（可自定义，需与下级配置缩进对齐）
  run_tests:
    # 运行环境：使用最新版 Ubuntu 系统（Github 托管 runner）
    runs-on: ubuntu-latest
    # 任务步骤：按顺序执行的操作
    steps:
      # 步骤1：检出仓库代码（从 Github 拉取当前推送的代码到 runner）
      - name: Checkout the repository
        uses: actions/checkout@v4
      # 步骤2：配置 JDK17（匹配 Lab4 实验要求的开发环境）
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'       # JDK 版本（与本地 Maven 项目一致）
          distribution: 'temurin'  # 推荐的 JDK 发行版（稳定兼容）
      # 步骤3：缓存 Maven 依赖（避免每次构建重复下载，加速测试）
      - name: Cache Maven packages
        uses: actions/cache@v4
        with:
          path: ~/.m2/repository  # Maven 依赖缓存路径（固定）
          # 缓存键：按系统+pom.xml 哈希值生成，pom 不变则复用缓存
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          # 备用缓存键：若精确键不匹配，复用同系统的旧缓存
          restore-keys: |
            ${{ runner.os }}-m2-
      # 步骤4：用 Maven 执行测试（核心操作，验证代码正确性）
      - name: Run tests with Maven
        run: mvn -B test --file pom.xml  # -B 表示"批处理模式"，避免交互